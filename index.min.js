/*
Jinzhong_Nest Web index.min.js
By @Phy25 - 2014/07/31
Other credits left through the script
*/
$(function(){function c(){if(d())return!1;var a=document.body||document.documentElement,b=a.style,c="transition";if("string"==typeof b[c])return!0;var e=["Moz","webkit","Webkit","Khtml","O","ms"];c=c.charAt(0).toUpperCase()+c.substr(1);for(var f=0;f<e.length;f++)if("string"==typeof b[e[f]+c])return!0;return!1}function d(){var a="track"in document.createElement("track"),b="scoped"in document.createElement("style"),c="v8Locale"in window,d=function(a,b,c,d){var e=window.navigator.mimeTypes;for(i in e)if(e[i][a]==b){if(void 0!==c&&d.test(e[i][c]))return!0;if(void 0===c)return!0}return!1};if(!d("type","application/vnd.chromium.remoting-viewer")&&window.chrome&&a){if(!b&&!c&&/Gecko\)\s+Chrome/.test(window.navigator.appVersion))return!0;if(b&&c)return!0}return!1}function g(a){a.attr("id")&&(a.find("a.btn.repost").click(function(){if($("#msg-id-inline-callback.active").length)return!1;if($("#inline-form").is(".active")&&"repost"==$("#inline-form-type").val()&&$("#inline-form").parents(".box").attr("id")==$(this).parents(".box").attr("id"))return h(),!1;var a=$("#inline-form").appendTo($(this).parents(".box-upper")).show();return j(a,$(this).parents(".box"),"repost"),!1}),a.find("a.btn.comment").click(function(){if($("#msg-id-inline-callback.active").length)return!1;if($("#inline-form").is(".active")&&"comment"==$("#inline-form-type").val()&&$("#inline-form").parents(".box").attr("id")==$(this).parents(".box").attr("id"))return h(),!1;var a=$("#inline-form").appendTo($(this).parents(".box-upper")).show();return j(a,$(this).parents(".box"),"comment"),!1}));var b=a.find(".box-content-e p:first");b.html(function(b,c){var e,f,d=c.match(/^(.*)\u300c(.+)\u300d$/);return null!==d?(e=d[2],f=d[1]):(e="Admin",f=c),"wx"==e&&(e="WeChat"),"web"==e&&(e="Web"),a.find("span.source").text("#"+e),$.trim(f)})}function h(){$("#inline-form").removeClass("active").slideUp(),$("#reply").blur()}function j(a,b,c){"object"==typeof b?($p=b,b=$p.attr("id")):$p=!1,a.find("#inline-form-type").val(c),a.find("#inline-form-parent-id").val(b),a.addClass("active"),"comment"==c&&(a.find("span.typetext").text("\u8bc4\u8bba"),a.find("#inline-form-submit").text("\u533f\u540d\u8bc4\u8bba")),"repost"==c&&(a.find("span.typetext").text("\u8f6c\u53d1"),a.find("#inline-form-submit").text("\u533f\u540d\u8f6c\u53d1")),$p&&a.find("a.backlink").attr("href",$p.find("a.morelink").attr("href")+"?type="+c),$("#reply").focus()}function k(a,b){a.source||(a.source="Web");var c='<div class="box"'+(a.id?' id="'+a.id+'"':"")+'><div class="box-content-e"><p>'+$("<div/>").text(a.content).html()+'</p></div><div class="box-upper"><div class="left time"><p><time>'+a.createdAt+'</time> <span class="source">#'+a.source+'</span> <a href="'+a.link+'" target="_blank" class="btn morelink" title="\u8fd4\u56de\u5fae\u535a\u770b\u56fe\u3001\u70b9\u8d5e">\u66f4\u591a</a></p></div><div class="right"><p><a href="'+a.link+'?type=repost" class="btn repost">\u8f6c\u53d1('+a.repCount+')</a><a href="'+a.link+'?type=comment" class="btn comment">\u8bc4\u8bba('+a.cmtCount+")</a></p></div></div></div>";if(b){var d=$(c);return g(d),d}return c}function l(b,c,d,e,f){if(!d)var d="error";if(void 0===e)var e=5e3;if($("#msg-id-"+c).length){var g=$("#msg-id-"+c).find("p:first").text(b).end();clearTimeout(a["msg-id-"+c])}else{var g=$('<div id="msg-id-'+c+'" class="box pointer '+d+'"><div class="box-content center"><p>'+$("<div/>").text(b).html()+"</p></div></div>").on("click",function(){$(this).remove()});f?f.after(g):g.prependTo("#content")}0!==e&&(a["msg-id-"+c]=setTimeout(function(){g.remove()},e))}function m(a){return $("a.ajax",a).click(function(a){if("undefined"!=typeof operamini)return!0;a.preventDefault(),$("#ajaxContent").length||$("#content").before('<div id="ajaxContent"></div>');var b=$("#ajaxContent").html('<div class="box progress-bar-striped active"><div class="box-content center"><p>\u6b63\u5728\u52a0\u8f7d</p></div></div>');window.scrollTo(0,0);var c=function(a){if(b.empty().hide(),"object"==typeof a)var c=$(a);else var c=$("<div>").append(a.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""));b.append(m(c.find("#content").children())).slideDown()},d=function(a){var c=b.find(".box.active:first");c.addClass("error pointer").removeClass("progress-bar-striped active").find("p:first").text("\u8f7d\u5165\u9519\u8bef\uff08"+a.statusText+", "+a.status+"\uff09"),c.click(function(){return $(this).remove(),!1})};return $.get(this.href).done(c).error(d),!1}),a}var a={},b="3173227132",e=function(){var a=function(a){try{return a.replace(/^\s+|\s+$/g,"")}catch(b){return a}},b=function(a){if("undefined"==typeof a)return 0;var b=a.match(/[^\x00-\x80]/g);return a.length+(b?b.length:0)};return function(c,d){d=d||{},d.max=d.max||140,d.min=d.min||41,d.surl=d.surl||20;var e=a(c).length;if(e>0){for(var f=d.min,g=d.max,h=d.surl,i=c,j=c.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z\$\.\+\!\_\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],k=0,l=0,e=j.length;e>l;l++){var m=b(j[l]);/^(http:\/\/t.cn)/.test(j[l])||(k+=/^(http:\/\/)+(weibo.com|weibo.cn)/.test(j[l])?f>=m?m:g>=m?h:m-g+h:g>=m?h:m-g+h,i=i.replace(j[l],""))}return Math.ceil((k+b(i))/2)}return 0}}();$("#new-weibo-cover").click(function(){$(this).is(".active")||(setTimeout(function(){$("#new-weibo-cover").removeClass("progress-bar-striped success error")},600),$("#new-weibo-outer").addClass("on"),$("#status").focus(),"undefined"!=typeof localStorage&&(localStorage.jzth_nwopened="on"))}),$("#new-weibo-close").click(function(){$("#new-weibo-outer").removeClass("on"),"undefined"!=typeof localStorage&&(localStorage.jzth_nwopened="off")}),$("#new-weibo-content").on("keydown",function(a){return 27==a.keyCode?($("#new-weibo-close").click(),$("#new-weibo-cover").focus(),a.preventDefault(),!1):13==a.keyCode&&1==a.ctrlKey?($("#new-weibo-form").submit(),a.preventDefault(),!1):void 0}),$("#status").on("keyup keydown paste change",function(a,b){var c=136-e(this.value);$("#new-weibo-counter").text(c)[0>c?"addClass":"removeClass"]("warning"),b||"undefined"==typeof localStorage||(localStorage.jzth_status=this.value)}).trigger("paste",[!0]);var f=function(){var b=$("#pic")[0],c=b.files&&b.files[0]?b.files[0].name:b.value;c?$("#new-weibo-upload-btn").addClass("selected").attr("title","\u5df2\u9009\u53d6\u56fe\u7247\u6587\u4ef6 "+c):$("#new-weibo-upload-btn").removeClass("selected").attr("title","\u4e0a\u4f20\u56fe\u7247\u6587\u4ef6")};$("#pic").on("change",f),$("#new-weibo-form").on("reset",function(){setTimeout(function(){f(),$("#status").trigger("change")},0)}),$("#new-weibo-upload-btn").click(function(){return $("#pic").click(),!1}),$("#new-weibo-close").keyup(function(a){13==a.keyCode&&$("#new-weibo-cover").focus()}),$("#new-weibo-reset").click(function(){$("#status").focus()}),$("#new-weibo-cover").keydown(function(a){return 13==a.keyCode?($(this).click(),a.preventDefault(),!1):void 0}),c()||($("#new-weibo-cover").hide(),$("#new-weibo-cover").click(function(){$(this).is(".active")||($("#new-weibo-cover").hide(),$("#new-weibo-content").show(),$("#status").focus())}),$("#new-weibo-close").click(function(){$("#new-weibo-content").hide(),$("#new-weibo-cover").show()})),$("#new-weibo-form").submit(function(c){if("undefined"!=typeof operamini)return!0;if(c.preventDefault(),0==e($("#status").val()))return $("#status").val("").focus(),c.preventDefault(),!1;if($("#new-weibo-counter").is(".warning"))return l("\u5b57\u6570\u8fc7\u591a\uff0c\u8bf7\u4e0d\u8981\u505a\u8bdd\u75e8 :)","new-weibo-length","error",3e3),$("#status").focus(),c.preventDefault(),!1;$("#msg-id-new-weibo-failure").remove();var d=function(c){if(0==c.indexOf("okay")){var d=c.split("."),e=!1;d[1]?(d[2]&&(e=d[2]),d=d[1]):d=!1,$("#new-weibo-cover").removeClass("progress-bar-striped active").addClass("success"),$("#new-weibo-progress").text("\u53d1\u5e03\u6210\u529f");var g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=new Date,i=g[h.getMonth()],j=h.getDate(),l=h.getHours(),m=h.getMinutes(),n=h.getSeconds();10>l&&(l="0"+l),10>m&&(m="0"+m),10>n&&(n="0"+n);var o=i+" "+j+" "+l+":"+m+":"+n;k({content:$("#status").val()+" \u300cweb\u300d",createdAt:o,cmtCount:0,repCount:0,link:"http://weibo.com/"+b+"/"+(d!==!1?d:""),id:e},!0).hide().prependTo("#content").slideDown(),a["new-weibo-callback"]=setTimeout(function(){$("#new-weibo-cover").removeClass("success")},5e3),$("#new-weibo-form")[0].reset()}else{if(0==c.indexOf("gap")){var d=c.split(".")[1];return f({},"\u4e3a\u9632\u5237\u5c4f\uff0c\u8bf7\u7b49\u5f85 "+d+" \u79d2\uff0c\u518d\u53d1\u5e03\u65b0\u6811\u6d1e"),!1}if("other"==c)return f({},"other"),!1;f({},"\u7a0b\u5e8f\u9519\u8bef\uff1a"+c)}},f=function(a,b){"other"==b&&(b="\u5b57\u6570\u8fc7\u591a\uff0c\u56fe\u7247\u683c\u5f0f\u6709\u8bef\uff0c\u6216\u5fae\u535a\u7cfb\u7edf\u7e41\u5fd9\u7b49"),$("#new-weibo-cover").removeClass("progress-bar-striped active"),$("#status").focus(),$("#new-weibo-cover").click(),l("\u53d1\u5e03\u5931\u8d25\uff08"+b+"\uff09","new-weibo-failure","error",0)};return $("#new-weibo-progress").text("\u6b63\u5728\u53d1\u5e03"),$("#new-weibo-cover").addClass("progress-bar-striped active"),$("#new-weibo-close").click(),$("#status").blur(),clearTimeout(a["new-weibo-callback"]),$(this).ajaxSubmit({data:{ajax:!0},dataType:"text",success:d,error:f}),!1}),$("#reply-weibo-form").on("keydown",function(a){return 27==a.keyCode?(h(),a.preventDefault(),!1):13==a.keyCode&&1==a.ctrlKey?($("#reply-weibo-form").submit(),a.preventDefault(),!1):void 0}),$("#reply-weibo-form").submit(function(b){if("undefined"!=typeof operamini)return!0;var c=$(this);if(b.preventDefault(),0==e($("#reply").val()))return $("#reply").val("").focus(),!1;if(e($("#reply").val())>136)return l("\u5b57\u6570\u8fc7\u591a\uff0c\u8bf7\u4e0d\u8981\u505a\u8bdd\u75e8 :)","new-weibo-length","error",3e3,$(this).parents(".box")),$("#reply").focus(),!1;var d=function(b){if("okay"==b){$("#msg-id-inline-callback").removeClass("progress-bar-striped active").addClass("success pointer").click(function(){return $(this).remove(),!1}).find("p:first").text("\u53d1\u5e03\u6210\u529f");var d=c.parents(".box-upper"),e=d.find("#inline-form-type").val();d.find("a.btn."+e).text(function(a,b){var c=b.match(/^(.+)\((\d+)\)$/);return null==c?b:c[2]?c[1]+"("+(+c[2]+1)+")":void 0}),a["inline-callback"]=setTimeout(function(){$("#msg-id-inline-callback").remove()},5e3),$("#reply-weibo-form")[0].reset()}else{if(0==b.indexOf("gap")){var g=b.split(".")[1];return f({},"\u4e3a\u9632\u5237\u5c4f\uff0c\u8bf7\u7b49\u5f85 "+g+" \u79d2\uff0c\u518d\u53d1\u5e03\u65b0\u6811\u6d1e"),!1}if("other"==b)return f({},"other"),!1;f({},"\u7a0b\u5e8f\u9519\u8bef\uff1a"+b)}},f=function(b,c){"other"==c&&(c="\u5b57\u6570\u8fc7\u591a\uff0c\u6216\u8005\u5fae\u535a\u7cfb\u7edf\u7e41\u5fd9\u7b49"),$("#msg-id-inline-callback").removeClass("progress-bar-striped active"),$("#inline-form").show(),$("#reply").focus(),$("#msg-id-inline-callback").addClass("error pointer").click(function(){return $(this).remove(),!1}).find("p:first").text("\u53d1\u5e03\u5931\u8d25\uff08"+c+"\uff09"),a["inline-callback"]=setTimeout(function(){$("#msg-id-inline-callback").remove()},1e4)};return $("#msg-id-inline-callback").remove(),$(this).parents(".box").after('<div id="msg-id-inline-callback" class="box progress-bar-striped active"><div class="box-content center"><p>\u6b63\u5728\u53d1\u5e03</p></div></div>'),h(),clearTimeout(a["inline-callback"]),$(this).ajaxSubmit({data:{ajax:!0},dataType:"text",success:d,error:f}),!1}),$("#content .box").each(function(a,b){g($(b))}),m(document),"undefined"!=typeof localStorage&&($("#status").val()||$("#status").val(localStorage.jzth_status),"off"==localStorage.jzth_nwopened&&$("#new-weibo-close").click())});